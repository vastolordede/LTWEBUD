<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý người dùng</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .sidebar { transition: transform 0.3s ease-in-out; }
  </style>
</head>
<body class="bg-gray-100">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="sidebar w-64 bg-gray-800 text-white p-4 fixed lg:relative h-full -translate-x-full lg:translate-x-0 z-20">
      <div class="text-2xl font-bold mb-8">Admin Panel</div>
      <nav>
                <a href="admin_dashboard.html" class="flex items-center p-3 my-1 hover:bg-gray-700 rounded-lg"><i class="fas fa-tachometer-alt mr-3"></i>Bảng điều khiển</a>
                <a href="admin_users.html" class="flex items-center p-3 my-1 hover:bg-gray-700 rounded-lg"><i class="fas fa-users mr-3"></i>Quản lý người dùng</a>
                <a href="admin_categories.html" class="flex items-center p-3 my-1 bg-gray-700 rounded-lg"><i class="fas fa-tags mr-3"></i>Quản lý loại SP</a>
                <a href="admin_products.html" class="flex items-center p-3 my-1 hover:bg-gray-700 rounded-lg"><i class="fas fa-box mr-3"></i>Quản lý sản phẩm</a>
                <a href="admin_imports.html" class="flex items-center p-3 my-1 hover:bg-gray-700 rounded-lg"><i class="fas fa-truck-loading mr-3"></i>Quản lý nhập hàng</a>
                <a href="admin_pricing.html" class="flex items-center p-3 my-1 hover:bg-gray-700 rounded-lg"><i class="fas fa-dollar-sign mr-3"></i>Quản lý giá bán</a>
                <a href="admin_orders.html" class="flex items-center p-3 my-1 hover:bg-gray-700 rounded-lg"><i class="fas fa-shopping-cart mr-3"></i>Quản lý đơn hàng</a>
                <a href="admin_inventory.html" class="flex items-center p-3 my-1 hover:bg-gray-700 rounded-lg"><i class="fas fa-warehouse mr-3"></i>Quản lý tồn kho</a>
                 <a href="index.html" class="flex items-center p-3 mt-8 hover:bg-red-700 rounded-lg"><i class="fas fa-sign-out-alt mr-3"></i>Đăng xuất</a>
            </nav>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-6 lg:p-10">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Quản lý người dùng</h1>
        <button id="menu-button" class="lg:hidden text-gray-700">
          <i class="fas fa-bars fa-2x"></i>
        </button>
      </div>

      <div class="bg-white p-6 rounded-lg shadow-md">
        <div class="flex justify-between mb-4">
          <input id="search" type="text" placeholder="Tìm kiếm khách hàng..." class="border rounded p-2 w-1/3">
          <div id="flash" class="text-sm text-green-700"></div>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead>
              <tr class="bg-gray-200">
                <th class="p-3">ID</th>
                <th class="p-3">Tên khách hàng</th>
                <th class="p-3">Username</th>
                <th class="p-3">Email</th>
                <th class="p-3">Ngày đăng ký</th>
                <th class="p-3">Trạng thái</th>
                <th class="p-3">Hành động</th>
              </tr>
            </thead>
            <tbody id="user-tbody"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

<script>
// ===== Sidebar toggle & active nav =====
const menuButton = document.getElementById('menu-button');
const sidebar = document.querySelector('.sidebar');
if (menuButton && sidebar) {
  menuButton.addEventListener('click', () => {
    sidebar.classList.toggle('-translate-x-full');
  });
}
(function setActiveNav(){
  const links = document.querySelectorAll('.sidebar nav a');
  let current = location.pathname.split('/').pop();
  if (!current || current === '') current = 'index.html';
  links.forEach(a => {
    a.classList.remove('bg-gray-700');
    const href = a.getAttribute('href') || '';
    const normalized = href.split('/').pop();
    if (normalized === current) a.classList.add('bg-gray-700');
  });
})();

// ===== LocalStorage Users =====
const LS_USERS_KEY = 'admin_users';
function getUsers(){ try{ return JSON.parse(localStorage.getItem(LS_USERS_KEY)||'[]'); }catch(e){ return []; } }
function saveUsers(arr){ localStorage.setItem(LS_USERS_KEY, JSON.stringify(arr||[])); }

// (Tùy chọn) Seed mẫu lần đầu (bình luận để không làm bẩn dữ liệu thật)
// if(getUsers().length===0){ saveUsers([
//   {id:'U-DEMO-1',name:'Nguyễn Văn A',username:'nva',email:'nva@example.com',password:'123456',active:true,date:'10/10/2025',createdAt:new Date().toISOString()},
// ]); }

const tbody = document.getElementById('user-tbody');
const searchInput = document.getElementById('search');
const flash = document.getElementById('flash');

function renderUsers(list){
  if(!Array.isArray(list) || !list.length){
    tbody.innerHTML = `<tr><td colspan="7" class="p-4 text-gray-500 text-center">Chưa có người dùng.</td></tr>`;
    return;
  }
  tbody.innerHTML = list.map(u => `
    <tr class="border-b">
      <td class="p-3">${u.id}</td>
      <td class="p-3">${u.name || '-'}</td>
      <td class="p-3">${u.username || '-'}</td>
      <td class="p-3">${u.email || '-'}</td>
      <td class="p-3">${u.date || '-'}</td>
      <td class="p-3">
        <span class="${u.active ? 'text-green-600' : 'text-red-600'} font-semibold">
          ${u.active ? 'Hoạt động' : 'Đã khóa'}
        </span>
      </td>
      <td class="p-3 space-x-2">
        <button class="text-blue-500 hover:text-blue-700" title="Reset mật khẩu" onclick="resetPassword('${u.id}')">
          <i class="fas fa-key"></i>
        </button>
        ${u.active
          ? `<button class="text-red-500 hover:text-red-700" title="Khóa tài khoản" onclick="toggleUser('${u.id}', false)"><i class="fas fa-lock"></i></button>`
          : `<button class="text-green-500 hover:text-green-700" title="Mở khóa tài khoản" onclick="toggleUser('${u.id}', true)"><i class="fas fa-unlock"></i></button>`
        }
      </td>
    </tr>
  `).join('');
}

function refresh(){
  const data = getUsers();
  const kw = (searchInput.value||'').toLowerCase();
  const filtered = kw
    ? data.filter(u => (u.name||'').toLowerCase().includes(kw) ||
                       (u.email||'').toLowerCase().includes(kw) ||
                       (u.username||'').toLowerCase().includes(kw))
    : data;
  renderUsers(filtered);
}

window.resetPassword = function(id){
  const users = getUsers();
  const u = users.find(x => x.id === id);
  if(!u) return;
  if(confirm(`Xác nhận reset mật khẩu cho ${u.name || u.username}?`)){
    u.password = '123456';
    saveUsers(users);
    flash.textContent = `✅ Đã reset mật khẩu cho ${u.username} về "123456"`;
    setTimeout(()=> flash.textContent='', 2000);
  }
};

window.toggleUser = function(id, toActive){
  const users = getUsers();
  const u = users.find(x => x.id === id);
  if(!u) return;
  const action = toActive ? 'mở khóa' : 'khóa';
  if(confirm(`Bạn có chắc muốn ${action} tài khoản ${u.username}?`)){
    u.active = !!toActive;
    saveUsers(users);
    refresh();
  }
};

searchInput.addEventListener('input', refresh);
refresh(); // init
console.log('✅ Quản lý người dùng đã khởi động thành công');
</script>
</body>
</html>
